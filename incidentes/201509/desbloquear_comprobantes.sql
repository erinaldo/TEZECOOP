

	drop table tmp_desbloquear_viajes_18092015

	select top 1  nrComprabanteCliente , vlMontoCupon , nrLicencia , 'N' encontrado, 0 flCompensado   into tmp_desbloquear_viajes_18092015 from TB_Cupones 

	delete  from tmp_desbloquear_viajes_18092015

	 insert into tmp_desbloquear_viajes_18092015  ( nrComprabanteCliente , vlMontoCupon , nrLicencia , flCompensado , encontrado ) values ( 101333 , 350 , 62 , 0 , 'N' )
	 insert into tmp_desbloquear_viajes_18092015  ( nrComprabanteCliente , vlMontoCupon , nrLicencia , flCompensado , encontrado ) values ( 563272 , 350 , 62 , 0 , 'N' )
	 insert into tmp_desbloquear_viajes_18092015  ( nrComprabanteCliente , vlMontoCupon , nrLicencia , flCompensado , encontrado ) values ( 563782 , 350 , 62 , 0 , 'N' )
	 insert into tmp_desbloquear_viajes_18092015  ( nrComprabanteCliente , vlMontoCupon , nrLicencia , flCompensado , encontrado ) values ( 357368 , 350 , 62 , 0 , 'N' )
	 insert into tmp_desbloquear_viajes_18092015  ( nrComprabanteCliente , vlMontoCupon , nrLicencia , flCompensado , encontrado ) values ( 564546 , 350 , 62 , 0 , 'N' )
	 insert into tmp_desbloquear_viajes_18092015  ( nrComprabanteCliente , vlMontoCupon , nrLicencia , flCompensado , encontrado ) values ( 358262 , 380 , 62 , 0 , 'N' )
	 insert into tmp_desbloquear_viajes_18092015  ( nrComprabanteCliente , vlMontoCupon , nrLicencia , flCompensado , encontrado ) values ( 565591 , 350 , 62 , 0 , 'N' )
	 insert into tmp_desbloquear_viajes_18092015  ( nrComprabanteCliente , vlMontoCupon , nrLicencia , flCompensado , encontrado ) values ( 565735 , 350 , 62 , 0 , 'N' )
	 insert into tmp_desbloquear_viajes_18092015  ( nrComprabanteCliente , vlMontoCupon , nrLicencia , flCompensado , encontrado ) values ( 566008 , 350 , 62 , 0 , 'N' )
	 insert into tmp_desbloquear_viajes_18092015  ( nrComprabanteCliente , vlMontoCupon , nrLicencia , flCompensado , encontrado ) values ( 14154 , 380 , 62 , 0 , 'N' )
	 insert into tmp_desbloquear_viajes_18092015  ( nrComprabanteCliente , vlMontoCupon , nrLicencia , flCompensado , encontrado ) values ( 567010 , 380 , 62 , 0 , 'N' )
	 insert into tmp_desbloquear_viajes_18092015  ( nrComprabanteCliente , vlMontoCupon , nrLicencia , flCompensado , encontrado ) values ( 567400 , 380 , 62 , 0 , 'N' )
	 insert into tmp_desbloquear_viajes_18092015  ( nrComprabanteCliente , vlMontoCupon , nrLicencia , flCompensado , encontrado ) values ( 563044 , 350 , 2 , 0 , 'N' )
	 insert into tmp_desbloquear_viajes_18092015  ( nrComprabanteCliente , vlMontoCupon , nrLicencia , flCompensado , encontrado ) values ( 13747 , 350 , 2 , 0 , 'N' )
	 insert into tmp_desbloquear_viajes_18092015  ( nrComprabanteCliente , vlMontoCupon , nrLicencia , flCompensado , encontrado ) values ( 563590 , 350 , 2 , 0 , 'N' )
	 insert into tmp_desbloquear_viajes_18092015  ( nrComprabanteCliente , vlMontoCupon , nrLicencia , flCompensado , encontrado ) values ( 564415 , 350 , 2 , 0 , 'N' )
	 insert into tmp_desbloquear_viajes_18092015  ( nrComprabanteCliente , vlMontoCupon , nrLicencia , flCompensado , encontrado ) values ( 358878 , 330 , 2 , 0 , 'N' )
	 insert into tmp_desbloquear_viajes_18092015  ( nrComprabanteCliente , vlMontoCupon , nrLicencia , flCompensado , encontrado ) values ( 565306 , 350 , 2 , 0 , 'N' )
	 insert into tmp_desbloquear_viajes_18092015  ( nrComprabanteCliente , vlMontoCupon , nrLicencia , flCompensado , encontrado ) values ( 564787 , 350 , 2 , 0 , 'N' )
	 insert into tmp_desbloquear_viajes_18092015  ( nrComprabanteCliente , vlMontoCupon , nrLicencia , flCompensado , encontrado ) values ( 565908 , 370 , 2 , 0 , 'N' )
	 insert into tmp_desbloquear_viajes_18092015  ( nrComprabanteCliente , vlMontoCupon , nrLicencia , flCompensado , encontrado ) values ( 566331 , 380 , 2 , 0 , 'N' )
	 insert into tmp_desbloquear_viajes_18092015  ( nrComprabanteCliente , vlMontoCupon , nrLicencia , flCompensado , encontrado ) values ( 566900 , 380 , 2 , 0 , 'N' )
	 insert into tmp_desbloquear_viajes_18092015  ( nrComprabanteCliente , vlMontoCupon , nrLicencia , flCompensado , encontrado ) values ( 567326 , 380 , 2 , 0 , 'N' )
	 insert into tmp_desbloquear_viajes_18092015  ( nrComprabanteCliente , vlMontoCupon , nrLicencia , flCompensado , encontrado ) values ( 568170 , 380 , 2 , 0 , 'N' )
	 insert into tmp_desbloquear_viajes_18092015  ( nrComprabanteCliente , vlMontoCupon , nrLicencia , flCompensado , encontrado ) values ( 567798 , 380 , 2 , 0 , 'N' )
	 insert into tmp_desbloquear_viajes_18092015  ( nrComprabanteCliente , vlMontoCupon , nrLicencia , flCompensado , encontrado ) values ( 382079 , 400 , 1 , 0 , 'N' )
	 insert into tmp_desbloquear_viajes_18092015  ( nrComprabanteCliente , vlMontoCupon , nrLicencia , flCompensado , encontrado ) values ( 382016 , 400 , 1 , 0 , 'N' )
	 insert into tmp_desbloquear_viajes_18092015  ( nrComprabanteCliente , vlMontoCupon , nrLicencia , flCompensado , encontrado ) values ( 4523 , 400 , 11 , 0 , 'N' )
	 insert into tmp_desbloquear_viajes_18092015  ( nrComprabanteCliente , vlMontoCupon , nrLicencia , flCompensado , encontrado ) values ( 379273 , 400 , 11 , 0 , 'N' )
	 insert into tmp_desbloquear_viajes_18092015  ( nrComprabanteCliente , vlMontoCupon , nrLicencia , flCompensado , encontrado ) values ( 384501 , 400 , 11 , 0 , 'N' )
	 insert into tmp_desbloquear_viajes_18092015  ( nrComprabanteCliente , vlMontoCupon , nrLicencia , flCompensado , encontrado ) values ( 384028 , 400 , 11 , 0 , 'N' )


	 select y.flCompensado  , y.flAnulado ,  * from tmp_desbloquear_viajes_18092015 x inner join TB_Cupones y 
								on  y.nrComprabanteCliente  like '%0' + rtrim(ltrim( x.nrComprabanteCliente ))
								  and x.vlMontoCupon = y.vlMontoCupon  and x.nrLicencia = y.nrLicencia 
									where  dsUsuario like '%Eulises' and y.flCompensado = 1   and y.flanulado = 0
								  order by y.nrComprabanteCliente 
 
							 
	select * from tmp_desbloquear_viajes_18092015

	begin tran 


	update x set x.encontrado ='S' , x.flCompensado = y.flCompensado  from tmp_desbloquear_viajes_18092015 x inner join TB_Cupones y 
								on  y.nrComprabanteCliente  like '%0' + rtrim(ltrim( x.nrComprabanteCliente )) and x.vlMontoCupon = y.vlMontoCupon  and x.nrLicencia = y.nrLicencia
								where  dsUsuario like '%Eulises' and y.flCompensado = 1   and y.flanulado = 0

	update y set  y.flCompensado = 0 ,  y.dtCompensado = null , dsUsuario = dsUsuario + 'DES_18_09'    from tmp_desbloquear_viajes_18092015 x inner join TB_Cupones y 
								on  y.nrComprabanteCliente  like '%0' + rtrim(ltrim( x.nrComprabanteCliente )) and x.vlMontoCupon = y.vlMontoCupon  and x.nrLicencia = y.nrLicencia
								where  dsUsuario like '%Eulises' and y.flCompensado = 1   and y.flanulado = 0

	rollback tran 

	commit tran